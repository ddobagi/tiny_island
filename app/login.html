<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Google ë¡œê·¸ì¸</title>
    
    <!-- âœ… Firebase SDK ì¶”ê°€ -->
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth-compat.js"></script>

</head>
<body>

    <h2>Firebase Google ë¡œê·¸ì¸</h2>

    <!-- ë¡œê·¸ì¸ ë° ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
    <button id="google-login">Google ë¡œê·¸ì¸</button>
    <button id="logout" style="display: none;">ë¡œê·¸ì•„ì›ƒ</button>

    <!-- ì‚¬ìš©ì ì •ë³´ í‘œì‹œ -->
    <p id="user-info">ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>

    <script>
        // ğŸ”¹ 1. Firebase ì„¤ì • (Firebase Consoleì—ì„œ ë³µì‚¬í•œ ê°’ ì…ë ¥)
        const firebaseConfig = {
            apiKey: process.env.FIREBASE_API_KEY,
            authDomain: process.env.FIREBASE_AUTH_DOMAIN,
            projectId: process.env.FIREBASE_PROJECT_ID,
            storageBucket: process.env.FIREBASE_STORAGE_BUCKET,
            messagingSenderId: process.env.FIREBASE_MESSAGING_SENDER_ID,
            appId: process.env.FIREBASE_APP_ID
        };

        firebase.initializeApp(firebaseConfig);

        firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);

        // ğŸ”¹ 3. Google ë¡œê·¸ì¸ í”„ë¡œë°”ì´ë” ìƒì„±
        const provider = new firebase.auth.GoogleAuthProvider();

        // ğŸ”¹ 4. ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('google-login').addEventListener('click', () => {
            firebase.auth().signInWithPopup(provider)
                .then((result) => {
                    const user = result.user;
                    console.log("âœ… ë¡œê·¸ì¸ ì„±ê³µ:", user);
                    alert(`í™˜ì˜í•©ë‹ˆë‹¤, ${user.displayName}ë‹˜!`); // âœ… í…œí”Œë¦¿ ë¦¬í„°ëŸ´ ì‚¬ìš©
                    handleUserRedirect(user); // ë¡œê·¸ì¸ í›„ ìë™ ì´ë™
                })
                .catch((error) => {
                    console.error("âŒ ë¡œê·¸ì¸ ì˜¤ë¥˜:", error);
                });
        });

        // ğŸ”¹ 5. ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('logout').addEventListener('click', () => {
            firebase.auth().signOut().then(() => {
                alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
                updateUI(null); // UI ì—…ë°ì´íŠ¸
            }).catch((error) => {
                console.error("âŒ ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:", error);
            });
        });

        // ğŸ”¹ 6. ë¡œê·¸ì¸ ìƒíƒœ ë³€ê²½ ê°ì§€
        firebase.auth().onAuthStateChanged((user) => {
            updateUI(user);
            if (user) {
                handleUserRedirect(user); // ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€ í›„ ìë™ ì´ë™
            }
        });

        // ğŸ”¹ 7. UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateUI(user) {
            const userInfo = document.getElementById('user-info');
            const loginBtn = document.getElementById('google-login');
            const logoutBtn = document.getElementById('logout');

            if (user) {
                userInfo.innerHTML = `ë¡œê·¸ì¸í•œ ì‚¬ìš©ì: ${user.displayName} (${user.email})`; // âœ… í…œí”Œë¦¿ ë¦¬í„°ëŸ´ ì ìš©
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
            } else {
                userInfo.innerHTML = "ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
            }
        }

        // ğŸ”¹ 8. ë¡œê·¸ì¸ í›„ ì‚¬ìš©ìë³„ í˜ì´ì§€ ì´ë™ í•¨ìˆ˜
        function handleUserRedirect(user) {
            if (!user) return;

            const adminEmails = ["admin@example.com"]; // ğŸ”¥ ê´€ë¦¬ì ê³„ì • ë¦¬ìŠ¤íŠ¸
            if (adminEmails.includes(user.email)) {
                window.location.href = "/admin.html"; // âœ… ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™
            } else {
                window.location.href = `/dashboard.html?uid=${user.uid}`; // âœ… ì¼ë°˜ ì‚¬ìš©ì ê°œë³„ í˜ì´ì§€ ì´ë™ (í…œí”Œë¦¿ ë¦¬í„°ëŸ´ ì ìš©)
            }
        }
    </script>

</body>
</html>
