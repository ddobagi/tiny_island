<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Google 로그인</title>
    
    <!-- ✅ Firebase SDK 추가 -->
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth-compat.js"></script>

</head>
<body>

    <h2>Firebase Google 로그인</h2>

    <!-- 로그인 및 로그아웃 버튼 -->
    <button id="google-login">Google 로그인</button>
    <button id="logout" style="display: none;">로그아웃</button>

    <!-- 사용자 정보 표시 -->
    <p id="user-info">로그인한 사용자 정보가 없습니다.</p>

    <script>
        // 🔹 1. Firebase 설정 (Firebase Console에서 복사한 값 입력)
        const firebaseConfig = {
            apiKey: process.env.FIREBASE_API_KEY,
            authDomain: process.env.FIREBASE_AUTH_DOMAIN,
            projectId: process.env.FIREBASE_PROJECT_ID,
            storageBucket: process.env.FIREBASE_STORAGE_BUCKET,
            messagingSenderId: process.env.FIREBASE_MESSAGING_SENDER_ID,
            appId: process.env.FIREBASE_APP_ID
        };

        firebase.initializeApp(firebaseConfig);
        firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);

        // 🔹 3. Google 로그인 프로바이더 생성
        const provider = new firebase.auth.GoogleAuthProvider();

        // 🔹 4. 로그인 버튼 클릭 이벤트 (팝업 차단 방지 → signInWithRedirect 사용)
        document.getElementById('google-login').addEventListener('click', () => {
            firebase.auth().signInWithRedirect(provider);
        });

        // 🔹 5. 로그인 후 리디렉션 결과 확인
        firebase.auth().getRedirectResult().then((result) => {
            if (result.user) {
                console.log("✅ 로그인 성공:", result.user);
                alert(`환영합니다, ${result.user.displayName}님!`);
                window.location.href = "/dashboard.html"; // 로그인 후 자동 이동
            }
        }).catch((error) => {
            console.error("❌ 로그인 오류:", error);
        });

        // 🔹 6. 로그인 상태 변경 감지
        firebase.auth().onAuthStateChanged((user) => {
            updateUI(user);
            if (user) {
                // 로그인한 상태이면 대시보드로 이동
                window.location.href = "/dashboard.html";
            }
        });

        // 🔹 7. UI 업데이트 함수
        function updateUI(user) {
            const userInfo = document.getElementById('user-info');
            const loginBtn = document.getElementById('google-login');
            const logoutBtn = document.getElementById('logout');

            if (user) {
                userInfo.innerHTML = `로그인한 사용자: ${user.displayName} (${user.email})`;
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
            } else {
                userInfo.innerHTML = "로그인한 사용자 정보가 없습니다.";
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
            }
        }

        // 🔹 8. 로그아웃 기능 추가
        document.getElementById('logout').addEventListener('click', () => {
            firebase.auth().signOut().then(() => {
                alert("로그아웃 되었습니다.");
                window.location.href = "/login.html"; // 로그아웃 후 로그인 페이지로 이동
            }).catch((error) => {
                console.error("❌ 로그아웃 오류:", error);
            });
        });
    </script>

</body>
</html>
