<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Google ๋ก๊ทธ์ธ</title>
    
    <!-- โ Firebase SDK ์ถ๊ฐ -->
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth-compat.js"></script>

</head>
<body>

    <h2>Firebase Google ๋ก๊ทธ์ธ</h2>

    <!-- ๋ก๊ทธ์ธ ๋ฐ ๋ก๊ทธ์์ ๋ฒํผ -->
    <button id="google-login">Google ๋ก๊ทธ์ธ</button>
    <button id="logout" style="display: none;">๋ก๊ทธ์์</button>

    <!-- ์ฌ์ฉ์ ์๋ณด ํ์ -->
    <p id="user-info">๋ก๊ทธ์ธํ ์ฌ์ฉ์ ์๋ณด๊ฐ ์์ต๋๋ค.</p>

    <script>
        // ๐น 1. Firebase ์ค์ (Firebase Console์์ ๋ณต์ฌํ ๊ฐ ์๋ฅ)
        const firebaseConfig = {
            apiKey: process.env.FIREBASE_API_KEY,
            authDomain: process.env.FIREBASE_AUTH_DOMAIN,
            projectId: process.env.FIREBASE_PROJECT_ID,
            storageBucket: process.env.FIREBASE_STORAGE_BUCKET,
            messagingSenderId: process.env.FIREBASE_MESSAGING_SENDER_ID,
            appId: process.env.FIREBASE_APP_ID
        };

        firebase.initializeApp(firebaseConfig);
        firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);

        // ๐น 3. Google ๋ก๊ทธ์ธ ํ๋ก๋ฐ์ด๋ ์์ฑ
        const provider = new firebase.auth.GoogleAuthProvider();

        // ๐น 4. ๋ก๊ทธ์ธ ๋ฒํผ ํด๋ฆญ ์ด๋ฒคํธ (ํ์ ์ฐจ๋จ ๋ฐฉ์ง โ signInWithRedirect ์ฌ์ฉ)
        document.getElementById('google-login').addEventListener('click', () => {
            firebase.auth().signInWithRedirect(provider);
        });

        // ๐น 5. ๋ก๊ทธ์ธ ํ ๋ฆฌ๋๋์ ๊ฒฐ๊ณผ ํ์ธ
        firebase.auth().getRedirectResult().then((result) => {
            if (result.user) {
                console.log("โ ๋ก๊ทธ์ธ ์ฑ๊ณต:", result.user);
                alert(`ํ์ํฉ๋๋ค, ${result.user.displayName}๋!`);
                window.location.href = "/dashboard.html"; // ๋ก๊ทธ์ธ ํ ์๋ ์ด๋
            }
        }).catch((error) => {
            console.error("โ ๋ก๊ทธ์ธ ์ค๋ฅ:", error);
        });

        // ๐น 6. ๋ก๊ทธ์ธ ์ํ ๋ณ๊ฒฝ ๊ฐ์ง
        firebase.auth().onAuthStateChanged((user) => {
            updateUI(user);
            if (user) {
                // ๋ก๊ทธ์ธํ ์ํ์ด๋ฉด ๋์๋ณด๋๋ก ์ด๋
                window.location.href = "/dashboard.html";
            }
        });

        // ๐น 7. UI ์๋ฐ์ดํธ ํจ์
        function updateUI(user) {
            const userInfo = document.getElementById('user-info');
            const loginBtn = document.getElementById('google-login');
            const logoutBtn = document.getElementById('logout');

            if (user) {
                userInfo.innerHTML = `๋ก๊ทธ์ธํ ์ฌ์ฉ์: ${user.displayName} (${user.email})`;
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
            } else {
                userInfo.innerHTML = "๋ก๊ทธ์ธํ ์ฌ์ฉ์ ์๋ณด๊ฐ ์์ต๋๋ค.";
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
            }
        }

        // ๐น 8. ๋ก๊ทธ์์ ๊ธฐ๋ฅ ์ถ๊ฐ
        document.getElementById('logout').addEventListener('click', () => {
            firebase.auth().signOut().then(() => {
                alert("๋ก๊ทธ์์ ๋์์ต๋๋ค.");
                window.location.href = "/login.html"; // ๋ก๊ทธ์์ ํ ๋ก๊ทธ์ธ ํ์ด์ง๋ก ์ด๋
            }).catch((error) => {
                console.error("โ ๋ก๊ทธ์์ ์ค๋ฅ:", error);
            });
        });
    </script>

</body>
</html>
