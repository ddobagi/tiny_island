<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ìš©ì ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth-compat.js"></script>
</head>
<body>

    <h2>ì‚¬ìš©ì ëŒ€ì‹œë³´ë“œ</h2>
    <p id="user-info">ë¡œê·¸ì¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>

    <!-- âœ… ìŠ¤í”„ë ˆë“œì‹œíŠ¸ URL ì…ë ¥ í¼ -->
    <div id="spreadsheet-section">
        <label for="spreadsheet-url">Google ìŠ¤í”„ë ˆë“œì‹œíŠ¸ URL:</label>
        <input type="url" id="spreadsheet-url" placeholder="ìŠ¤í”„ë ˆë“œì‹œíŠ¸ URLì„ ì…ë ¥í•˜ì„¸ìš”" required>
        <button id="save-url">ì €ì¥</button>
        <button id="edit-url" style="display: none;">ìˆ˜ì •</button>
    </div>

    <button id="logout">ë¡œê·¸ì•„ì›ƒ</button>

    <script>
        // ğŸ”¹ 1. Firebase ì„¤ì • (Firebase Consoleì—ì„œ ë³µì‚¬í•œ ê°’ ì…ë ¥)
        const firebaseConfig = {
            apiKey: process.env.FIREBASE_API_KEY,
            authDomain: process.env.FIREBASE_AUTH_DOMAIN,
            projectId: process.env.FIREBASE_PROJECT_ID,
            storageBucket: process.env.FIREBASE_STORAGE_BUCKET,
            messagingSenderId: process.env.FIREBASE_MESSAGING_SENDER_ID,
            appId: process.env.FIREBASE_APP_ID
        };

        firebase.initializeApp(firebaseConfig);

        // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                document.getElementById("user-info").innerHTML = `
                    í™˜ì˜í•©ë‹ˆë‹¤, ${user.displayName}!<br>
                    ì´ë©”ì¼: ${user.email} <br>
                    UID: ${user.uid}
                `;

                // ğŸ”¹ ì €ì¥ëœ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ URL ë¶ˆëŸ¬ì˜¤ê¸°
                const savedUrl = localStorage.getItem(`spreadsheet_url_${user.uid}`);
                if (savedUrl) {
                    document.getElementById("spreadsheet-url").value = savedUrl;
                    document.getElementById("spreadsheet-url").disabled = true;
                    document.getElementById("save-url").style.display = "none";
                    document.getElementById("edit-url").style.display = "inline-block";
                }
            } else {
                // ë¡œê·¸ì¸ ì•ˆ ë˜ì–´ ìˆìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
                window.location.href = "login.html";
            }
        });

        // ğŸ”¹ URL ì €ì¥ ê¸°ëŠ¥
        document.getElementById("save-url").addEventListener("click", () => {
            const user = firebase.auth().currentUser;
            if (!user) return;

            const urlInput = document.getElementById("spreadsheet-url").value.trim();
            if (urlInput) {
                localStorage.setItem(`spreadsheet_url_${user.uid}`, urlInput);
                document.getElementById("spreadsheet-url").disabled = true;
                document.getElementById("save-url").style.display = "none";
                document.getElementById("edit-url").style.display = "inline-block";
                alert("ìŠ¤í”„ë ˆë“œì‹œíŠ¸ URLì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
            } else {
                alert("ìœ íš¨í•œ URLì„ ì…ë ¥í•˜ì„¸ìš”.");
            }
        });

        // ğŸ”¹ URL ìˆ˜ì • ê¸°ëŠ¥
        document.getElementById("edit-url").addEventListener("click", () => {
            document.getElementById("spreadsheet-url").disabled = false;
            document.getElementById("save-url").style.display = "inline-block";
            document.getElementById("edit-url").style.display = "none";
        });

        // ğŸ”¹ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
        document.getElementById("logout").addEventListener("click", () => {
            firebase.auth().signOut().then(() => {
                window.location.href = "login.html"; // ë¡œê·¸ì•„ì›ƒ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
            });
        });
    </script>

</body>
</html>
